# Markdown 风格指南

Markdown 令人耳目一新的原因之一是能够编写纯文本并获得出色的格式化输出。为了为下一位作者保持干净的板面，您的 Markdown 应该尽可能简单且与整个文集保持一致。

我们寻求平衡三个目标：

1.  *源文本可读且便携。*
2.  *Markdown 文集可以随着时间和跨团队维护。*
3.  *语法简单且易于记忆。*

目录：

1.  [最低可行文档](#最低可行文档)
1.  [更好胜过最好](#更好胜过最好)
1.  [大写规则](#大写规则)
1.  [文档布局](#文档布局)
1.  [目录](#目录)
1.  [字符行限制](#字符行限制)
1.  [尾随空白](#尾随空白)
1.  [标题](#标题)
    1.  [ATX 风格标题](#atx-风格标题)
    1.  [为标题使用独特且完整的名称](#为标题使用独特且完整的名称)
    1.  [为标题添加间距](#为标题添加间距)
    1.  [使用单个 H1 标题](#使用单个-h1-标题)
    1.  [标题和头部的首字母大写](#标题和头部的首字母大写)
1.  [列表](#列表)
    1.  [为长列表使用惰性编号](#为长列表使用惰性编号)
    1.  [嵌套列表间距](#嵌套列表间距)
1.  [代码](#代码)
    1.  [内联](#内联)
    1.  [使用代码跨度进行转义](#使用代码跨度进行转义)
    1.  [代码块](#代码块)
        1.  [声明语言](#声明语言)
        1.  [转义换行](#转义换行)
        1.  [使用围栏代码块而不是缩进代码块](#使用围栏代码块而不是缩进代码块)
        1.  [在列表中嵌套代码块](#在列表中嵌套代码块)
1.  [链接](#链接)
    1.  [在 Markdown 内使用显式路径链接](#在-markdown-内使用显式路径链接)
    1.  [除非在同一目录内，否则避免使用相对路径](#除非在同一目录内-否则避免使用相对路径)
    1.  [使用信息性的 Markdown 链接标题](#使用信息性的-markdown-链接标题)
    1.  [参考链接](#参考链接)
        1.  [为长链接使用参考链接](#为长链接使用参考链接)
        1.  [使用参考链接减少重复](#使用参考链接减少重复)
        1.  [在首次使用后定义参考链接](#在首次使用后定义参考链接)
1.  [图片](#图片)
1.  [表格](#表格)
1.  [强烈偏好 Markdown 而非 HTML](#强烈偏好-markdown-而非-html)

## 最低可行文档

一小组新鲜且准确的文档比各种状态不佳的“文档”的大杂烩要好。

**Markdown 方式**鼓励工程师对他们的文档负责，并以我们保持测试良好的热情保持文档的更新。努力实现这一点。

*   确定您真正需要的：发布文档、API 文档、测试指南。
*   经常且小批量地删除冗余内容。

## 更好胜过最好

内部文档审查的标准与代码审查的标准不同。审查者应该要求改进，但一般来说，作者总是可以援引“更好/最好规则”。

快速迭代是您的朋友。为了获得长期改进，**作者必须在进行短期改进时保持生产力**。为每个 CL 设置较低的标准，以便**更多这样的 CL** 可以发生。

作为文档 CL 的审查者：

1.  在合理的情况下，立即 LGTM 并信任评论将被适当修复。
2.  宁愿建议替代方案也不要留下模糊的评论。
3.  对于重大更改，请启动您自己的后续 CL。特别要避免类似“你应该*也*...”的评论。
4.  在极少数情况下，如果 CL 实际上使文档变差，请阻止提交。可以要求作者撤销。

作为作者：

1.  避免因琐碎的争论浪费时间。早点让步并继续前进。
2.  必要时经常引用更好/最好规则。

## 大写规则

使用产品、工具和二进制文件的原始名称，保留其大写形式。例如：

```markdown
# Markdown 风格指南

`Markdown` 是一个用于内部工程文档的简单平台。
```

而不是

```markdown
# markdown 错误风格指南示例

`markdown` 是一个用于内部工程文档的简单平台。
```

## 文档布局

一般来说，文档从以下布局的某种变体中受益：

```markdown
# 文档标题

简短介绍。

[TOC]

## 主题

内容。
## 另见

* https://link-to-more-info

1.  `# 文档标题`: 第一个标题应为第一级标题，理想情况下应与文件名相同或几乎相同。第一个第一级标题用作页面 `<title>`。

1.  `author`: *可选*。如果您想声明对文档的所有权或对此感到非常骄傲，请在标题下添加您的名字。然而，修订历史通常就足够了。

1.  `简短介绍。` 1-3 句话提供主题的高层次概述。想象自己是一个完全的新手，偶然发现了您的“扩展 Foo”文档，并且不知道您认为理所当然的最基本信息。“什么是 Foo？我为什么要扩展它？”

1.  `[TOC]`: 如果您使用支持目录的托管服务，如 Gitiles，请在简短介绍后放置 `[TOC]`。参见 [`[TOC]` 文档][TOC-docs]。

1.  `## 主题`: 您的其余标题应从第二级开始。

1.  `## 另见`: 将杂项链接放在底部，供想要了解更多信息或未找到所需内容的用户使用。

[TOC-docs]: https://gerrit.googlesource.com/gitiles/+/HEAD/Documentation/markdown.md#Table-of-contents

## 目录

### 使用 `[TOC]` 指令

除非您的所有内容都在笔记本电脑上“折叠以上”[^above]，否则使用 [`[TOC]` 指令][TOC-docs]。

[^above]: 如果内容在页面首次显示时可见，则内容为“折叠以上”。如果内容在用户滚动页面或实际展开文档（如报纸）之前隐藏，则内容为“折叠以下”。

### 在介绍后放置 `[TOC]` 指令

将 `[TOC]` 指令放在页面的介绍之后和第一个 H2 标题之前。例如：

```markdown
# 我的页面

这是我的介绍，位于 TOC **之前**。

[TOC]

## 我的第一个 H2
```

```markdown
# 我的页面

[TOC]

这是我的介绍，位于 TOC **之后**，不应如此。

## 我的第一个 H2
```

对于视觉阅读文档的用户来说，`[TOC]` 指令的位置并不重要，因为 Markdown 总是将 TOC 显示在页面顶部和右侧。然而，当涉及到屏幕阅读器或键盘控制时，`[TOC]` 的位置非常重要。
这是因为 `[TOC]` 将目录的 HTML 插入到您在 Markdown 文件中包含指令的位置的 DOM 中。例如，如果您将指令放在文件的底部，屏幕阅读器直到文档末尾才读取它。

## 字符行限制

Markdown 内容遵循 80 个字符的行限制的传统惯例。为什么？因为这是我们大多数人编写代码时所做的。

*   **工具集成**: 我们所有的工具都是围绕代码设计的，因此我们的文档格式越符合类似的规则，这些工具的效果就越好。例如，代码搜索不进行软换行。

*   **质量**。工程师在创建和编辑 Markdown 内容时使用他们熟悉的编码习惯，质量会更好。Markdown 利用了我们已经拥有的优秀审查文化。

### 例外情况

80 字符规则的例外情况包括：

*   链接
*   表格
*   标题
*   代码块

这意味着带有链接的行可以超过第 80 列，连同任何相关标点符号：

```markdown
*   查看
    [foo 文档](https://gerrit.googlesource.com/gitiles/+/HEAD/Documentation/markdown.md)。
    并找到日志文件。
```

然而，请注意链接前后的文本会被换行。

表格也可能很长。然而，有[创建短小、可读表格的最佳实践](#tables)。

```markdown
Foo                                                                           | Bar | Baz
----------------------------------------------------------------------------- | --- | ---
无法避免的长单元格充满了拒绝换行的内容                                   | Foo | Bar
```

## 尾随空白

不要使用尾随空白。使用尾随反斜杠来断行。

[CommonMark 规范](http://spec.commonmark.org/0.20/#hard-line-breaks)规定，行的末尾有两个空格应插入 `<br />` 标签。然而，许多目录有针对尾随空白的预提交检查，许多 IDE 也会自动清理它。

谨慎使用尾随反斜杠：

```markdown
由于某些原因，我真的很想在这里断行，\
尽管这可能不是必要的。
```

最佳实践是完全避免需要 `<br />`。一对换行符将创建一个段落标签；习惯于此。

## 标题

### ATX 风格标题

```markdown
# 标题 1

## 标题 2
```

带有 `=` 或 `-` 下划线的标题可能难以维护，并且不符合其他标题语法。一个编辑器必须问：`---` 表示 H1 还是 H2？

```markdown
标题 - 你记得是什么级别吗？不要这样做。
---------
```

### 使用唯一、完整的标题名称

为每个标题使用唯一且完全描述性的名称，即使是子部分。由于链接锚点是从标题构建的，这有助于确保自动构建的锚点链接直观且清晰。

例如，而不是：

```markdown
## Foo
### 摘要
### 示例
## Bar
### 摘要
### 示例
```

更喜欢：

```markdown
## Foo
### Foo 摘要
### Foo 示例
## Bar
### Bar 摘要
### Bar 示例
```

### 为标题添加间距

在 `#` 后和标题前后添加间距：

```markdown
...前面的文本。

## 标题 2

后面的文本...
```

源代码中缺乏间距会使阅读稍微困难：

```markdown
...前面的文本。

##标题 2
后面的文本...不要这样做。
```

### 使用单个 H1 标题

使用一个 H1 标题作为文档的标题。后续标题应为 H2 或更深。有关更多信息，请参见 [文档布局](#document-layout)。
### 标题和头部的 capitalization

遵循 [Google Developer Documentation Style Guide](https://developers.google.com/style/) 中关于 [capitalization](https://developers.google.com/style/capitalization#capitalization-in-titles-and-headings) 的指导。

## 列表

### 对长列表使用懒惰编号

Markdown 足够智能，可以让生成的 HTML 正确渲染你的编号列表。对于可能会更改的较长列表，尤其是长嵌套列表，使用“懒惰”编号：

```markdown
1.  Foo.
1.  Bar.
    1.  Foofoo.
    1.  Barbar.
1.  Baz.
```

然而，如果列表很小且你不打算更改它，优先使用完全编号的列表，因为在源代码中阅读更友好：

```markdown
1.  Foo.
2.  Bar.
3.  Baz.
```

### 嵌套列表的间距

在嵌套列表时，对于编号和项目符号列表都使用 4 个空格的缩进：

```markdown
1.  在项目编号后使用 2 个空格，因此文本本身缩进 4 个空格。
    对换行的文本使用 4 个空格的缩进。
2.  对下一个项目再次使用 2 个空格。

*   在项目符号后使用 3 个空格，因此文本本身缩进 4 个空格。
    对换行的文本使用 4 个空格的缩进。
    1.  如前所述，使用编号列表时使用 2 个空格。
        在嵌套列表中换行的文本需要 8 个空格的缩进。
    2.  看起来不错，对吗？
*   回到项目符号列表，缩进 3 个空格。
```

以下方法虽然可行，但非常混乱：

```markdown
* 一个空格，
没有对换行文本进行缩进。
     1. 不规则的嵌套...不要这样做。
```

即使没有嵌套，使用 4 个空格的缩进也能使换行文本的布局保持一致：

```markdown
*   Foo，
    使用 4 个空格缩进换行。

1.  列表项使用 2 个空格
    换行文本前使用 4 个空格。
2.  回到 2 个空格。
```

然而，当列表很小、不嵌套且只有一行时，一个空格对于两种类型的列表就足够了：

```markdown
* Foo
* Bar
* Baz.

1. Foo.
2. Bar.
```

## 代码

### 内联

&#96;反引号&#96; 指定 `内联代码`，它将按字面渲染。用于短代码引用、字段名称等：

```markdown
你需要运行 `really_cool_script.sh arg`。

注意表格中的 `foo_bar_whammy` 字段。
```

在泛指文件类型而不是特定现有文件时，使用内联代码：

```markdown
确保更新你的 `README.md`！
```

### 使用代码跨度进行转义

当你不希望文本被处理为普通 Markdown 时，比如假路径或示例 URL 会导致错误的自动链接，将其包裹在反引号中：

```markdown
一个示例 Markdown 短链接将是：`Markdown/foo/Markdown/bar.md`

一个示例查询可能是：`https://www.google.com/search?q=$TERM`
```

### 代码块

对于超过一行的代码引用，使用带围栏的代码块：

<pre>
```python
def Foo(self, bar):
  self.bar = bar
```
</pre>

#### 声明语言

最佳实践是明确声明语言，这样既不需要语法高亮器也不需要下一个编辑器来猜测。

#### 使用带围栏的代码块而不是缩进的代码块

四空格缩进也被解释为代码块。然而，我们强烈推荐对所有代码块使用围栏。

缩进的代码块在源代码中有时看起来更干净，但它们有几个缺点：

*   你无法指定语言。一些 Markdown 功能与语言指定器相关联。
*   代码块的开始和结束是模糊的。
*   在代码搜索中查找缩进的代码块更难。

```markdown
你需要运行：

    bazel run :thing -- --foo

然后：
```markdown
    bazel run :another_thing -- --bar

再次：

    bazel run :yet_again -- --baz
```

#### 转义换行

因为大多数命令行片段旨在直接复制并粘贴到终端中，最佳实践是转义任何换行。在行尾使用单个反斜杠：

<pre>
```shell
$ bazel run :target -- --flag --foo=longlonglonglonglongvalue \
  --bar=anotherlonglonglonglonglonglonglonglonglonglongvalue
```
</pre>

#### 在列表中嵌套代码块

如果你需要在列表中使用代码块，确保缩进它以免破坏列表：

```markdown
*   项目符号。

    ```c++
    int foo;
    ```

*   下一个项目符号。
```

你也可以使用 4 个空格创建嵌套代码块。只需从列表缩进处额外缩进 4 个空格：

```markdown
*   项目符号。

        int foo;

*   下一个项目符号。
```

## 链接

长链接使源 Markdown 难以阅读并破坏 80 个字符的换行。**尽可能缩短你的链接**。

### 在 Markdown 内使用显式路径进行链接

对于 Markdown 链接使用显式路径。例如：

```markdown
[...](/path/to/other/markdown/page.md)
```

你不需要使用完整的限定 URL：

```markdown
[...](https://bad-full-url.example.com/path/to/other/markdown/page.md)
```

### 避免使用相对路径，除非在同一目录内

在同一目录内使用相对路径是相当安全的。例如：

```markdown
[...](other-page-in-same-dir.md)
[...](/path/to/another/dir/other-page.md)
```

如果需要使用 `../` 指定其他目录，避免使用相对链接：

```markdown
[...](../../bad/path/to/another/dir/other-page.md)
```
### 使用信息丰富的Markdown链接标题

Markdown链接语法允许您设置链接标题。请明智地使用它。用户通常不会仔细阅读文档；他们只是浏览。

链接会吸引眼球。但是，如果您的链接标题是“这里”、“链接”，或者只是重复目标URL，这对匆忙的读者来说毫无意义，并且是浪费空间：

```markdown
不要这样做。

有关更多信息，请参阅Markdown指南：[链接](markdown.md)，或者查看[这里](style.md)的样式指南。

查看一个典型的测试结果：
[https://example.com/foo/bar](https://example.com/foo/bar)。
```

相反，先自然地写出句子，然后返回并用链接包裹最合适的短语：

```markdown
有关更多信息，请参阅[Markdown指南](markdown.md)，或者查看[样式指南](style.md)。

查看一个[典型的测试结果](https://example.com/foo/bar)。
```

### 参考

对于长链接或图像URL，您可能希望将链接使用与链接定义分开，像这样：

<!-- 已知错误：我们在这里使用零宽度不间断空格（U+FEFF）来防止 -->
<!-- 参考链接在代码块中渲染。 -->

```markdown
请参阅[Markdown样式指南][style]，其中有关于使文档更易读的建议。

[style]: http://Markdown/corp/Markdown/docs/reference/style.md
```

#### 对长链接使用参考链接

当链接的长度会影响周围文本的可读性时，请使用参考链接。如果链接是内联的，参考链接会使源文本中难以看到链接的目的地，并且会增加额外的语法。

在这个例子中，参考链接的使用是不合适的，因为链接不够长，不会打乱文本的流动：

```markdown
不要这样做。

[样式指南][style_guide]说，除非必须，否则不要使用参考链接。

[style_guide]: https://google.com/Markdown-style
```

直接内联它：

```markdown
https://google.com/Markdown-style说，除非必须，否则不要使用参考链接。
```

在这个例子中，链接目的地足够长，使用参考链接是有意义的：

```markdown
[样式指南]说，除非必须，否则不要使用参考链接。

[样式指南]: https://docs.google.com/document/d/13HQBxfhCwx8lVRuN2Wf6poqvAfVeEXmFVcawP5I6B3c/edit
```

在表格中更常使用参考链接。保持表格内容简短尤为重要，因为Markdown不提供在单元格表格中跨多行的文本换行的功能，且较小的表格更易读。

例如，这个表格的可读性因内联链接而变差：

```markdown
不要这样做。

站点                                                             | 描述
---------------------------------------------------------------- | -----------------------
[站点1](http://google.com/excessively/long/path/example_site_1) | 这是示例站点1。
[站点2](http://google.com/excessively/long/path/example_site_2) | 这是示例站点2。
```

相反，使用参考链接来保持行长度可控：

```markdown
站点     | 描述
-------- | -----------------------
[站点1] | 这是示例站点1。
[站点2] | 这是示例站点2。

[站点1]: http://google.com/excessively/long/path/example_site_1
[站点2]: http://google.com/excessively/long/path/example_site_2
```

#### 使用参考链接减少重复

在文档中多次引用同一链接目的地时，考虑使用参考链接以减少重复。

#### 在首次使用后定义参考链接

我们建议将参考链接定义放在它们首次使用的部分结束前，紧接下一个标题之前。如果您的编辑器对它们的位置有自己的看法，不要与之对抗；工具总是会赢。

我们定义“部分”为两个标题之间的所有文本。把参考链接想象成脚注，当前部分就像当前页面。

这种安排使得在源视图中容易找到链接目的地，同时保持文本流动不受干扰。在包含大量参考链接的长文档中，这也避免了文件底部的“脚注超载”，这使得难以挑选出相关的链接目的地。

这一规则有一个例外：在多个部分中使用的参考链接定义应放在文档末尾。这避免了在更新或移动部分时出现悬挂链接。

在以下示例中，参考定义与其首次使用相距甚远，这使得文档更难阅读：

```markdown
# 一个坏文档的标题

一些带有[链接][link_def]的文本。

更多带有相同[链接][link_def]的文本。

## 标题2

... 很多文本 ...

## 标题3

使用[不同链接][different_link_def]的更多文本。
```
[link_def]: http://reallyreallyreallylonglink.com
[different_link_def]: http://differentreallyreallylonglink.com
```

相反，将其放在首次使用后的标题之前：

```markdown
# 标题

一些带有[链接][link_def]的文本。

更多带有相同[链接][link_def]的文本。

[link_def]: http://reallyreallyreallylonglink.com

## 标题2

... 很多文本 ...

## 标题3

使用[不同链接][different_link_def]的更多文本。

[different_link_def]: http://differentreallyreallylonglink.com
```
## 图像

请参阅[图像语法](https://gerrit.googlesource.com/gitiles/+/HEAD/Documentation/markdown.md#Images)。

谨慎使用图像，并优先选择简单的截图。本指南的设计理念是，纯文本能让用户更快地进入沟通状态，减少读者的分心和作者的拖延。然而，有时展示你的意思非常有帮助。

*   当向读者展示某物比描述更容易时，请使用图像。例如，解释如何导航用户界面时，使用图像通常比文本更容易。
*   确保提供适当的文本来描述你的图像。视力不佳的读者无法看到你的图像，但仍然需要理解内容！请参阅下面的替代文本最佳实践。

## 表格

当它们有意义时使用表格：用于需要快速扫描的表格数据的展示。

当你的数据可以轻松地以列表形式呈现时，请避免使用表格。列表在Markdown中更易于编写和阅读。

例如：

```markdown
不要这样做

Fruit  | Metrics      | Grows on | Acute curvature    | Attributes                                                                                                  | Notes
------ | ------------ | -------- | ------------------ | ----------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------
Apple  | Very popular | Trees    |                    | [Juicy](http://cs/SomeReallyReallyReallyReallyReallyReallyReallyReallyLongQuery), Firm, Sweet               | Apples keep doctors away.
Banana | Very popular | Trees    | 16 degrees average | [Convenient](http://cs/SomeDifferentReallyReallyReallyReallyReallyReallyReallyReallyLongQuery), Soft, Sweet | Contrary to popular belief, most apes prefer mangoes. Don't you? See the [design doc][banana_v2] for the newest hotness in bananiels.
```

此表格展示了一些典型问题：

*   **分布不均**：几列在行间没有差异，有些单元格为空。这通常表明你的数据可能不适合表格显示。

*   **尺寸不平衡**：相对于列，行数较少。当这种比例在任一方向上不平衡时，表格就变成了文本的僵硬格式。

*   **某些单元格中的冗长散文**。表格应该在第一眼就能讲述一个简洁的故事。

[列表](#lists)和子标题有时足以呈现相同的信息。让我们看看这些数据以列表形式呈现：

```markdown
## 水果

两种类型都非常受欢迎，甜美，且生长在树上。

### 苹果

*   [多汁](http://SomeReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyReallyLongURL)
*   坚实

苹果能远离医生。

### 香蕉

*   [方便](http://cs/SomeDifferentReallyReallyReallyReallyReallyReallyReallyReallyLongQuery)
*   柔软
*   平均急性弯曲度为16度。

与普遍看法相反，大多数猩猩更喜欢芒果。你不也是吗？

查看[设计文档][banana_v2]，了解香蕉的最新热门动态。

列表形式更为宽敞，因此在这种情况下，读者更容易找到感兴趣的内容，这一点无可争辩。

然而，有时候表格是最佳选择。当你有以下情况时：

*   在两个维度上具有相对均匀的数据分布。
*   许多具有不同属性的并行项目。

在这些情况下，表格格式正是你所需要的。事实上，一个紧凑的表格可以提高可读性：

```markdown
交通工具        | 偏爱者         | 优点
---------------- | -------------- | -----------------------------------------------
燕子            | 椰子           | [空载时速度快][airspeed]
自行车          | 古尔奇小姐     | [防风雨][tornado_proofing]
X-34陆地飞车    | 爱抱怨的农家男孩 | [自从X-38问世以来便宜][tosche_station]

[airspeed]: http://google3/airspeed.h
[tornado_proofing]: http://google3/kansas/
[tosche_station]: http://google3/power_converter.h
```

请注意，使用[参考链接](#reference-links)来保持表格单元格的可管理性。

## 强烈倾向于使用Markdown而不是HTML

请尽可能使用标准Markdown语法，并避免使用HTML技巧。如果你似乎无法实现你想要的效果，请重新考虑你是否真的需要它。除了[大表格](#tables)外，Markdown几乎已经满足了所有需求。

每一点HTML技巧都会降低我们Markdown文集的可读性和可移植性。这反过来又限制了与其他工具的集成，这些工具可能以纯文本形式呈现源代码或对其进行渲染。参见[哲学](philosophy.md)。

Gitiles不渲染HTML。